// Match logic with fallback + weighting